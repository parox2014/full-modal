{"version":3,"sources":["jquery.plugin.full-modal.js"],"names":["global","$","Error","__UID__","parentWindow","parent","Events","BEFORE_OPEN","BEFORE_CLOSE","AFTER_OPEN","AFTER_CLOSE","Helpers","prefix","str","cssname","value","prefixes","cssRules","forEach","fn","delay","t","window","clearTimeout","setTimeout","bind","EventEmitter","_callbackMapper","evt","callback","callbacks","Array","isArray","push","isFunction","splice","indexOf","args","apply","ModalManager","modals","openedModals","modal","on","activateModal","target","length","addClass","pop","deactivateModal","hasOpenedModal","removeClass","Backdrop","singleton","close","uid","find","item","getById","index","activate","deactivate","lastModal","container","duration","isOpen","initialize","el","$el","append","emit","fadeIn","fadeOut","FullModal","option","$modalEl","$modalBody","isActivated","isClosing","backdrop","uniqueId","data","closeWhenClickBackdrop","onCloseButtonClick","e","stopPropagation","css","autoprefixer","trigger","open","setHeightWithWindowInnerHeight","addEventListener","debounce","height","innerHeight","top","scrollTop","beforeClose","call","onAniationEnd","afterOpen","postMessage","origin","animationRules","background","show","animate","transform","opacity","beforeOpen","afterClose","hide","zIndex","ACTIVATED_ZINDEX","DEACTIVATED_ZINDEX","ALLOW_USER_INVOKES","defaults","noop","modalManager","fullModal","options","each","$this","isString","method","console","error","toString","extend","add","Defaults","jQuery"],"mappings":"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","file":"jquery.plugin.full-modal.min.js","sourcesContent":["(function(global, $) {\r\n  if (!$) throw new Error('请先加载jquery');\r\n\r\n  /**\r\n   * @property\r\n   * @type {number}\r\n   */\r\n  global.__UID__ = 0;\r\n\r\n  const parentWindow = global.parent || global;\r\n\r\n  const Events = {\r\n    BEFORE_OPEN: 'BEFORE_OPEN',\r\n    BEFORE_CLOSE: 'BEFORE_CLOSE',\r\n    AFTER_OPEN: 'AFTER_OPEN',\r\n    AFTER_CLOSE: 'AFTER_CLOSE'\r\n  };\r\n\r\n  class Helpers {\r\n    static uniqueId(prefix = 'fm_') {\r\n      return `${prefix}${++global.__UID__}`;\r\n    }\r\n\r\n    static isString(str) {\r\n      return typeof str === 'string';\r\n    }\r\n\r\n    static autoprefixer(cssname, value) {\r\n      let prefixes = ['webkit', 'moz', 'ms', 'o'];\r\n      let cssRules = {};\r\n\r\n      prefixes.forEach(prefix => {\r\n        cssRules[`-${prefix}-${cssname}`] = value;\r\n      });\r\n      return cssRules;\r\n    }\r\n\r\n    static debounce(fn, delay = 100) {\r\n      let t;\r\n      return function() {\r\n        window.clearTimeout(t);\r\n\r\n        t = setTimeout(fn.bind(this), delay);\r\n      };\r\n    }\r\n\r\n    static isFunction(fn) {\r\n      return typeof fn === 'function';\r\n    }\r\n  }\r\n\r\n  class EventEmitter {\r\n    constructor() {\r\n      /**\r\n       * @type {{[key:string]:Function[]}}\r\n       */\r\n      this._callbackMapper = {};\r\n    }\r\n\r\n    /**\r\n     * 添加事件\r\n     * @param {string} evt 事件名\r\n     * @param {Function} callback 回调 \r\n     */\r\n    on(evt, callback) {\r\n      let callbacks = this._callbackMapper[evt];\r\n\r\n      if (Array.isArray(callbacks)) {\r\n        return callbacks.push(callback);\r\n      }\r\n      this._callbackMapper[evt] = [callback];\r\n    }\r\n\r\n    /**\r\n     * 移除事件\r\n     * @param {string} evt 事件名\r\n     * @param {Function} [callback] 回调，如不传，则移除所有回调  \r\n     */\r\n    off(evt, callback) {\r\n      let callbacks = this._callbackMapper[evt];\r\n      if (Helpers.isFunction(callback)) {\r\n        return callbacks.splice(callbacks.indexOf(callback), 1);\r\n      }\r\n\r\n      this._callbackMapper[evt] = [];\r\n    }\r\n\r\n    /**\r\n     * 触发事件\r\n     * @param {string} evt 事件名\r\n     * @param {any[]} args 需要传递的数据\r\n     */\r\n    emit(evt, ...args) {\r\n      let callbacks = this._callbackMapper[evt];\r\n      if (Array.isArray(callbacks)) {\r\n        callbacks.forEach(callback => callback.apply(this, args));\r\n      }\r\n    }\r\n  }\r\n\r\n  class ModalManager {\r\n    constructor() {\r\n      /**\r\n       * @type {FullModal[]}\r\n       */\r\n      this.modals = [];\r\n\r\n      /**\r\n       * @type {FullModal[]}\r\n       */\r\n      this.openedModals = [];\r\n    }\r\n\r\n    /**\r\n     * 添加modal\r\n     * @param {FullModal} modal FullModal实例\r\n     */\r\n    add(modal) {\r\n      this.modals.push(modal);\r\n\r\n      modal.on('on-open', target => {\r\n        this.activateModal(target);\r\n        this.openedModals.push(target);\r\n\r\n        if (this.openedModals.length === 1) {\r\n          $('html').addClass('full-modal-open');\r\n        }\r\n      });\r\n\r\n      modal.on('on-close', target => {\r\n        this.openedModals.pop();\r\n        this.deactivateModal(target);\r\n        if (!this.hasOpenedModal()) {\r\n          $('html').removeClass('full-modal-open');\r\n          Backdrop.singleton.close();\r\n        }\r\n      });\r\n    }\r\n\r\n    /**\r\n     * 根据ID获取modal\r\n     * @param {string|number} uid ModalId\r\n     * @returns {FullModal}\r\n     */\r\n    getById(uid) {\r\n      return this.modals.find(item => item.uid === uid);\r\n    }\r\n\r\n    /**\r\n     * 根据id删除modal\r\n     * @param {string|number} uid ModalId\r\n     */\r\n    removeById(uid) {\r\n      let modal = this.getById(uid);\r\n      let index = this.modals.indexOf(modal);\r\n      this.modals.splice(index, 1);\r\n    }\r\n\r\n    /**\r\n     * 当前是否还有打开的modal\r\n     * @returns {boolean}\r\n     */\r\n    hasOpenedModal() {\r\n      return this.openedModals.length > 0;\r\n    }\r\n\r\n    /**\r\n     * 激活指定Modal，其它modal deactivate\r\n     * @param {FullModal} modal FullModal实例\r\n     */\r\n    activateModal(modal) {\r\n      modal.activate();\r\n      this.openedModals.forEach(item => item.deactivate());\r\n    }\r\n\r\n    /**\r\n     * deactiate 指定modal 自动激活它的前一个modal\r\n     * @param {FullModal} modal FullModal实例\r\n     */\r\n    deactivateModal(modal) {\r\n      modal.deactivate();\r\n\r\n      let lastModal = this.openedModals[this.openedModals.length - 1];\r\n\r\n      lastModal && lastModal.activate();\r\n    }\r\n  }\r\n\r\n  class Backdrop extends EventEmitter {\r\n    /**\r\n     * @type {Backdrop}\r\n     */\r\n    static singleton = null;\r\n\r\n    /**\r\n     * \r\n     * @param {string} container 容器\r\n     * @param {number} duration 动画持续时间\r\n     */\r\n    constructor(container, duration) {\r\n      super();\r\n      if (Backdrop.singleton instanceof Backdrop) return Backdrop.singleton;\r\n\r\n      /**\r\n       * @type {boolean}\r\n       */\r\n      this.isOpen = false;\r\n\r\n      /**\r\n       * @type {number}\r\n       */\r\n      this.duration = duration;\r\n\r\n      /**\r\n       * @type {JQuery<HTMLELement>}\r\n       */\r\n      this.container = $(container);\r\n\r\n      this.initialize();\r\n\r\n      Backdrop.singleton = this;\r\n    }\r\n\r\n    initialize() {\r\n      let el = (this.$el = $('<div class=\"ibs-backdrop\"></div>'));\r\n\r\n      this.container.append(el);\r\n\r\n      el.on('click', () => {\r\n        this.emit('on-backdrop-click', this);\r\n      });\r\n    }\r\n\r\n    open() {\r\n      this.$el.fadeIn(this.duration);\r\n      this.isOpen = true;\r\n    }\r\n\r\n    close() {\r\n      this.$el.fadeOut(this.duration);\r\n      this.isOpen = false;\r\n    }\r\n  }\r\n\r\n  class FullModal extends EventEmitter {\r\n    static ACTIVATED_ZINDEX = 102;\r\n\r\n    static DEACTIVATED_ZINDEX = 101;\r\n    /**\r\n     * create a modal instance\r\n     * @param {JQuery<HTMLElement>} el \r\n     * @param {Object} option\r\n     * @param {number} option.duration\r\n     * @param {string} option.trigger\r\n     * @param {boolean} option.closeWhenClickBackdrop\r\n     * @param {string} option.origin\r\n     * @param {Function} option.beforeOpen\r\n     * @param {Function} option.beforeClose\r\n     * @param {Function} option.afterOpen\r\n     * @param {Function} option.afterClose\r\n     */\r\n    constructor(el, option) {\r\n      super();\r\n\r\n      this.$el = el;\r\n      this.option = option;\r\n\r\n      /**\r\n       * @type {JQuery<HTMLElement>}\r\n       */\r\n      this.$modalEl = this.$el.find('.ibs-full-modal');\r\n\r\n      /**\r\n       * @type {JQuery<HTMLElement>}\r\n       */\r\n      this.$modalBody = this.$el.find('.ibs-modal-body');\r\n\r\n      /**\r\n       * @type {boolean}\r\n       */\r\n      this.isOpen = false;\r\n\r\n      /**\r\n       * @type {boolean}\r\n       */\r\n      this.isActivated = false;\r\n\r\n      /**\r\n       * @type {boolean}\r\n       */\r\n      this.isClosing = false;\r\n\r\n      /**\r\n       * @type {Backdrop}\r\n       */\r\n      this.backdrop = new Backdrop('body', option.duration + 200);\r\n\r\n      /**\r\n       * @readonly\r\n       * @type {string}\r\n       */\r\n      this.uid = Helpers.uniqueId();\r\n\r\n      this.$el.data('uniqueId', this.uid);\r\n      this.initialize();\r\n    }\r\n\r\n    initialize() {\r\n      if (this.option.closeWhenClickBackdrop) {\r\n        this.$el.on('click', () => this.onCloseButtonClick());\r\n      }\r\n\r\n      this.backdrop.on('on-backdrop-click', () => {\r\n        if (this.option.closeWhenClickBackdrop && this.isActivated) {\r\n          this.close();\r\n        }\r\n      });\r\n\r\n      this.$modalEl\r\n        .on('click', e => e.stopPropagation())\r\n        .on('click', '.ibs-btn-close', () => this.onCloseButtonClick());\r\n\r\n      this.$modalEl.css(\r\n        Helpers.autoprefixer('transition', 'all ' + this.option.duration + 'ms')\r\n      );\r\n\r\n      if (this.option.trigger) {\r\n        $(this.option.trigger).on('click', () => {\r\n          this.open();\r\n        });\r\n      }\r\n\r\n      this.setHeightWithWindowInnerHeight();\r\n      window.addEventListener(\r\n        'resize',\r\n        Helpers.debounce(this.setHeightWithWindowInnerHeight).bind(this)\r\n      );\r\n    }\r\n    setHeightWithWindowInnerHeight() {\r\n      let height = window.innerHeight;\r\n      this.$el.height(height);\r\n    }\r\n\r\n    scrollTop(top = 0) {\r\n      this.$modalBody.scrollTop(top);\r\n    }\r\n    onCloseButtonClick() {\r\n      if (this.isClosing) return;\r\n      this.isClosing = true;\r\n      this.option.beforeClose.call(this, this.close.bind(this));\r\n    }\r\n\r\n    open() {\r\n      let callback = () => {\r\n        let onAniationEnd = () => {\r\n          this.option.afterOpen.call(this);\r\n          parentWindow.postMessage(Events.AFTER_OPEN, this.option.origin);\r\n        };\r\n\r\n        let animationRules = {\r\n          background: '#fff'\r\n        };\r\n\r\n        parentWindow.postMessage(Events.BEFORE_OPEN, this.option.origin);\r\n\r\n        this.backdrop.open();\r\n\r\n        this.$el.show();\r\n\r\n        this.$modalEl.animate(\r\n          animationRules,\r\n          this.option.duration,\r\n          onAniationEnd\r\n        );\r\n\r\n        this.$modalEl.css({\r\n          transform: 'translateX(0)',\r\n          opacity: 1\r\n        });\r\n\r\n        this.isOpen = true;\r\n        this.emit('on-open', this);\r\n      };\r\n\r\n      this.option.beforeOpen.call(this, callback);\r\n    }\r\n    close() {\r\n      let onAniationEnd = () => {\r\n        this.option.afterClose.call(this);\r\n\r\n        parentWindow.postMessage(Events.AFTER_CLOSE, this.option.origin);\r\n\r\n        this.$el.hide();\r\n        this.emit('on-close', this);\r\n      };\r\n\r\n      let animationRules = {\r\n        background: 'transparent'\r\n      };\r\n\r\n      this.isClosing = false;\r\n\r\n      parentWindow.postMessage(Events.BEFORE_CLOSE, this.option.origin);\r\n\r\n      this.$modalEl.animate(\r\n        animationRules,\r\n        this.option.duration,\r\n        onAniationEnd\r\n      );\r\n      this.$modalEl.css({\r\n        transform: 'translateX(30%)',\r\n        opacity: 0\r\n      });\r\n\r\n      this.isOpen = false;\r\n    }\r\n\r\n    activate() {\r\n      this.isActivated = true;\r\n      this.$el.css({\r\n        zIndex: FullModal.ACTIVATED_ZINDEX\r\n      });\r\n    }\r\n\r\n    deactivate() {\r\n      this.isActivated = false;\r\n      this.$el.css({\r\n        zIndex: FullModal.DEACTIVATED_ZINDEX\r\n      });\r\n    }\r\n  }\r\n\r\n  const ALLOW_USER_INVOKES = ['open', 'close', 'scrollTop'];\r\n\r\n  const defaults = {\r\n    duration: 300,\r\n    trigger: '',\r\n    closeWhenClickBackdrop: true,\r\n    beforeOpen: function(callback) {\r\n      callback();\r\n    },\r\n    beforeClose: function(callback) {\r\n      callback();\r\n    },\r\n    origin: '*',\r\n    afterOpen: $.noop,\r\n    afterClose: $.noop\r\n  };\r\n\r\n  const modalManager = new ModalManager();\r\n\r\n  /**\r\n  * @param {Object} options\r\n  * @param {number} options.duration 动画持续时间\r\n  * @param {string} options.trigger 触发器\r\n  * @param {boolean} options.closeWhenClickBackdrop 点击backdrop时，是否关闭当前modal\r\n  * @param {string} options.origin 向父窗口发送消时，需要的来源域名\r\n  * @param {Function} options.beforeOpen modal打开之前的勾子\r\n  * @param {Function} options.beforeClose modal关闭之前的勾子\r\n  * @param {Function} options.afterOpen modal打开之后的勾子\r\n  * @param {Function} options.afterClose modal关闭之后的勾子\r\n  * @param {any[]} args\r\n  */\r\n  $.fn.fullModal = function(options, ...args) {\r\n    return this.each(function() {\r\n      let $this = $(this);\r\n\r\n      if (Helpers.isString(options)) {\r\n        let uid = $this.data('uniqueId');\r\n        let modal = modalManager.getById(uid);\r\n        let method = options;\r\n        // console.log('uid:',uid);\r\n        if (modal) {\r\n          if (ALLOW_USER_INVOKES.indexOf(method) < 0) {\r\n            return console.error(\r\n              `method:\"${method}\" is not allowed invoke on modal instance,expected method are [${ALLOW_USER_INVOKES.toString()}]`\r\n            );\r\n          }\r\n\r\n          return modal[method].apply(modal, args);\r\n        } else {\r\n          return console.error('please initialize modal first');\r\n        }\r\n      }\r\n\r\n      let option = $.extend({}, defaults, options);\r\n\r\n      let modal = new FullModal($this, option);\r\n\r\n      modalManager.add(modal);\r\n    });\r\n  };\r\n\r\n  $.fn.fullModal.Events = Events;\r\n\r\n  $.fn.fullModal.Defaults = defaults;\r\n})(window, jQuery);\r\n"]}