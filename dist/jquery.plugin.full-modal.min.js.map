{"version":3,"sources":["jquery.plugin.full-modal.js"],"names":["global","$","opacity","arguments","length","undefined","__UID__","isString","str","autoprefixer","cssname","value","modals","modal","isActivated","$el","cssRules","Error","fullModalMapper","Map","backdrop","BEFORE_OPEN","BEFORE_CLOSE","ACTIVATED_ZINDEX","AFTER_OPEN","AFTER_CLOSE","DEACTIVATED_ZINDEX","parent","location","origin","indexOf","Backdrop","parentWindow","_classCallCheck","this","isOpen","duration","container","initialize","_createClass","key","el","append","on","item","option","closeWhenClickBackdrop","close","forEach","filter","fadeOut","fadeIn","FullModal","$modalEl","find","$modalBody","isClosing","_this","onCloseButtonClick","e","stopPropagation","callback","call","postMessage","Events","ORIGIN","_this2","activate","open","show","animate","background","addClass","css","top","scrollTop","bind","_this3","removeClass","afterClose","beforeOpen","hide","deactivate","zIndex","trigger","beforeClose","noop","fn","fullModal","options","_len","args","Array","_key","each","$this","prefix","uid","data","method","ALLOW_USER_INVOKES","console","error","toString","apply","extend","defaults","id","set","Defaults","window","jQuery"],"mappings":"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","file":"jquery.plugin.full-modal.min.js","sourcesContent":["(function (global, $) {\r\n  if (!$) throw new Error('请先加载jquery');\r\n\r\n  const fullModalMapper = new Map();\r\n  const modals = [];\r\n  global.__UID__=0;\r\n  let backdrop;\r\n  \r\n  const ACTIVATED_ZINDEX = 102;\r\n\r\n  const DEACTIVATED_ZINDEX = 101;\r\n\r\n  const Events = {\r\n    BEFORE_OPEN: 'BEFORE_OPEN',\r\n    BEFORE_CLOSE: 'BEFORE_CLOSE',\r\n    AFTER_OPEN: 'AFTER_OPEN',\r\n    AFTER_CLOSE: 'AFTER_CLOSE',\r\n  };\r\n\r\n  let parentWindow = global.parent || global;\r\n\r\n  const ORIGIN = location.origin.indexOf('http') > -1 ? location.origin : '*';\r\n\r\n\r\n  class Backdrop {\r\n    constructor(container, duration) {\r\n      if (backdrop instanceof Backdrop) return backdrop;\r\n\r\n      this.isOpen = false;\r\n      this.duration = duration;\r\n      this.container = $(container);\r\n      this.initialize();\r\n    }\r\n\r\n    initialize() {\r\n      let el = this.$el = $('<div class=\"ibs-backdrop\"></div>');\r\n      this.container.append(el);\r\n      el.on('click', () => {\r\n        modals.forEach(item => {\r\n          if (item.option.closeWhenClickBackdrop) {\r\n            item.close();\r\n          }\r\n        })\r\n      });\r\n    }\r\n\r\n    open() {\r\n      this.$el.fadeIn(this.duration);\r\n      this.isOpen = true;\r\n    }\r\n\r\n    close() {\r\n      let openedModals = modals.filter(item => item.isOpen);\r\n\r\n      if (openedModals.length > 1) return;\r\n\r\n      this.$el.fadeOut(this.duration);\r\n      this.isOpen = false;\r\n    }\r\n  }\r\n\r\n\r\n  class FullModal {\r\n    /**\r\n     * create a modal instance\r\n     * @param el {jQuery|*}\r\n     * @param option {Object}\r\n     */\r\n    constructor(el, option) {\r\n      this.$el = el;\r\n      this.option = option;\r\n      this.$modalEl = this.$el.find('.ibs-full-modal');\r\n      this.$modalBody = this.$el.find('.ibs-modal-body');\r\n      this.isOpen = false;\r\n      this.isActivated = false;\r\n      this.isClosing=false;\r\n      this.backdrop = backdrop = new Backdrop('body', option.duration + 200);\r\n      this.initialize();\r\n    }\r\n\r\n    initialize() {\r\n\r\n      if (this.option.closeWhenClickBackdrop) {\r\n        this.$el.on('click', () => this.onCloseButtonClick());\r\n      }\r\n\r\n      this.$modalEl.on('click', e => e.stopPropagation())\r\n        .on('click', '.ibs-btn-close', () => this.onCloseButtonClick());\r\n\r\n      this.$modalEl.css(autoprefixer('transition', 'all ' + this.option.duration + 'ms'));\r\n    }\r\n\r\n    open() {\r\n\r\n      let callback = () => {\r\n        parentWindow.postMessage(Events.BEFORE_OPEN, ORIGIN)\r\n\r\n        this.activate();\r\n\r\n        this.backdrop.open();\r\n\r\n        this.$el.show();\r\n\r\n        this.$modalEl.animate({\r\n            background: '#fff'\r\n          }, this.option.duration, () => {\r\n\r\n            $('body').addClass('full-modal-open');\r\n\r\n            this.option.afterOpen.call(this);\r\n\r\n            parentWindow.postMessage(Events.AFTER_OPEN, ORIGIN);\r\n\r\n          }).css(autoprefixer('transform', 'translateX(0)'))\r\n          .css({\r\n            opacity: 1\r\n          });\r\n\r\n        this.isOpen = true;\r\n      }\r\n\r\n      this.option.beforeOpen.call(this, callback);\r\n\r\n    }\r\n    scrollTop(top = 0) {\r\n      this.$modalBody.scrollTop(top);\r\n    }\r\n    onCloseButtonClick() {\r\n      if(this.isClosing)return;\r\n      this.isClosing=true;\r\n      this.option.beforeClose.call(this, this.close.bind(this));\r\n    }\r\n    close() {\r\n      this.isClosing=false;\r\n      parentWindow.postMessage(Events.BEFORE_CLOSE, ORIGIN);\r\n\r\n      this.backdrop.close();\r\n\r\n      this.$modalEl.animate({\r\n          background: 'transparent'\r\n        }, this.option.duration, () => {\r\n\r\n          $('body').removeClass('full-modal-open');\r\n\r\n          this.option.afterClose.call(this);\r\n\r\n          parentWindow.postMessage(Events.AFTER_CLOSE, ORIGIN);\r\n\r\n          this.$el.hide();\r\n          this.deactivate();\r\n        })\r\n        .css(autoprefixer('transform', 'translateX(30%)'))\r\n        .css({\r\n          opacity: 0\r\n        });\r\n\r\n      this.isOpen = false;\r\n    }\r\n\r\n    activate() {\r\n\r\n      modals.forEach(modal => {\r\n        if (modal === this) {\r\n          modal.isActivated = true;\r\n          modal.$el.css({\r\n            zIndex: ACTIVATED_ZINDEX\r\n          });\r\n        } else {\r\n          modal.isActivated = false;\r\n          modal.$el.css({\r\n            zIndex: DEACTIVATED_ZINDEX\r\n          });\r\n        }\r\n      });\r\n    }\r\n\r\n    deactivate() {\r\n      this.isActivated = false;\r\n      this.$el.css({\r\n        zIndex: DEACTIVATED_ZINDEX\r\n      });\r\n    }\r\n  }\r\n\r\n\r\n  function uniqueId(prefix = 'fm_') {\r\n    return `${prefix}${++global.__UID__}`;\r\n  }\r\n\r\n  function isString(str) {\r\n    return typeof str === 'string';\r\n  }\r\n\r\n  function autoprefixer(cssname, value) {\r\n    let prefixes = ['webkit', 'moz', 'ms', 'o'];\r\n    let cssRules = {};\r\n\r\n    prefixes.forEach(prefix => {\r\n      cssRules[`-${prefix}-${cssname}`] = value;\r\n    });\r\n    return cssRules;\r\n  }\r\n\r\n  const ALLOW_USER_INVOKES = ['open', 'close', 'scrollTop'];\r\n  const defaults = {\r\n    duration: 300,\r\n    trigger: '',\r\n    closeWhenClickBackdrop: true,\r\n    beforeOpen: function (callback) {\r\n      callback()\r\n    },\r\n    beforeClose: function (callback) {\r\n      callback()\r\n    },\r\n    afterOpen: $.noop,\r\n    afterClose: $.noop\r\n  };\r\n\r\n  $.fn.fullModal = function (options, ...args) {\r\n\r\n    return this.each(function () {\r\n      let $this = $(this);\r\n\r\n      if (isString(options)) {\r\n        let uid=$this.data('uniqueId');\r\n        let modal = fullModalMapper.get(uid);\r\n        let method = options;\r\n        // console.log('uid:',uid);\r\n        if (modal) {\r\n\r\n          if (ALLOW_USER_INVOKES.indexOf(method) < 0) {\r\n            return console.error(`method:\"${method}\" is not allowed invoke on modal instance,expected method are [${ALLOW_USER_INVOKES.toString()}]`);\r\n          }\r\n\r\n          return modal[method].apply(modal, args);\r\n        } else {\r\n          return console.error('please initialize modal first');\r\n        }\r\n      }\r\n\r\n      let option = $.extend({},defaults, options);\r\n\r\n      let id = uniqueId();\r\n      let modal = new FullModal($this, option);\r\n      // console.log(id);\r\n      $this.data('uniqueId', id);\r\n\r\n      fullModalMapper.set(id, modal);\r\n      modals.push(modal);\r\n\r\n      if (option.trigger) {\r\n        $(option.trigger).on('click', function () {\r\n          modal.open();\r\n        });\r\n      }\r\n    });\r\n  };\r\n\r\n  $.fn.fullModal.Events = Events;\r\n\r\n  $.fn.fullModal.Defaults = defaults;\r\n})(window, jQuery);"]}