{"version":3,"sources":["jquery.plugin.full-modal.js"],"names":["global","$","debounce","fn","delay","arguments","length","undefined","t","window","clearTimeout","setTimeout","bind","this","uniqueId","__UID__","isString","str","modal","isActivated","value","zIndex","$el","forEach","prefix","cssname","Error","fullModalMapper","Map","modals","backdrop","BEFORE_OPEN","BEFORE_CLOSE","ACTIVATED_ZINDEX","AFTER_OPEN","AFTER_CLOSE","DEACTIVATED_ZINDEX","parent","location","origin","indexOf","hasOpenedModal","parentWindow","item","i","ORIGIN","isOpen","Backdrop","container","duration","_classCallCheck","initialize","_createClass","key","el","on","option","filter","fadeOut","FullModal","$modalEl","openedModals","find","$modalBody","isClosing","_this","closeWhenClickBackdrop","onCloseButtonClick","e","stopPropagation","css","autoprefixer","setHeightWithWindowInnerHeight","height","innerHeight","_this2","postMessage","Events","activate","open","show","animate","background","afterOpen","call","opacity","top","scrollTop","close","_this3","addClass","removeClass","afterClose","hide","deactivate","ALLOW_USER_INVOKES","defaults","trigger","beforeOpen","callback","beforeClose","noop","fullModal","options","_len","args","Array","_key","each","$this","uid","data","get","method","console","error","toString","apply","extend","id","push","Defaults"],"mappings":"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","file":"jquery.plugin.full-modal.min.js","sourcesContent":["(function(global, $) {\r\n  if (!$) throw new Error('请先加载jquery');\r\n\r\n  const fullModalMapper = new Map();\r\n\r\n  /**\r\n   * @type {FullModal[]}\r\n   */\r\n  const modals = [];\r\n  global.__UID__ = 0;\r\n  let backdrop;\r\n\r\n  const ACTIVATED_ZINDEX = 102;\r\n\r\n  const DEACTIVATED_ZINDEX = 101;\r\n\r\n  const Events = {\r\n    BEFORE_OPEN: 'BEFORE_OPEN',\r\n    BEFORE_CLOSE: 'BEFORE_CLOSE',\r\n    AFTER_OPEN: 'AFTER_OPEN',\r\n    AFTER_CLOSE: 'AFTER_CLOSE'\r\n  };\r\n\r\n  let parentWindow = global.parent || global;\r\n\r\n  const ORIGIN = location.origin.indexOf('http') > -1 ? location.origin : '*';\r\n\r\n  modals.hasOpenedModal=function(){\r\n\r\n    for(let i=0;i<this.length;i++){\r\n      let item=this[i];\r\n      console.log(item);\r\n      if(item.isOpen){\r\n        return true;\r\n      }\r\n    }\r\n    return false;\r\n  }\r\n\r\n  function debounce(fn, delay = 100) {\r\n    let t;\r\n    return function() {\r\n      window.clearTimeout(t);\r\n\r\n      t = setTimeout(fn.bind(this), delay);\r\n    };\r\n  }\r\n\r\n  class Backdrop {\r\n    constructor(container, duration) {\r\n      if (backdrop instanceof Backdrop) return backdrop;\r\n\r\n      this.isOpen = false;\r\n      this.duration = duration;\r\n      this.container = $(container);\r\n      this.initialize();\r\n    }\r\n\r\n    initialize() {\r\n      let el = (this.$el = $('<div class=\"ibs-backdrop\"></div>'));\r\n      this.container.append(el);\r\n      el.on('click', () => {\r\n        modals.forEach(item => {\r\n          if (item.option.closeWhenClickBackdrop) {\r\n            item.close();\r\n          }\r\n        });\r\n      });\r\n    }\r\n\r\n    open() {\r\n      this.$el.fadeIn(this.duration);\r\n      this.isOpen = true;\r\n    }\r\n\r\n    close() {\r\n      let openedModals = modals.filter(item => item.isOpen);\r\n\r\n      if (openedModals.length > 1) return;\r\n\r\n      this.$el.fadeOut(this.duration);\r\n      this.isOpen = false;\r\n    }\r\n  }\r\n\r\n  class FullModal {\r\n    /**\r\n     * create a modal instance\r\n     * @param el {jQuery|*}\r\n     * @param option {Object}\r\n     */\r\n    constructor(el, option) {\r\n      this.$el = el;\r\n      this.option = option;\r\n      this.$modalEl = this.$el.find('.ibs-full-modal');\r\n      this.$modalBody = this.$el.find('.ibs-modal-body');\r\n      this.isOpen = false;\r\n      this.isActivated = false;\r\n      this.isClosing = false;\r\n      this.backdrop = backdrop = new Backdrop('body', option.duration + 200);\r\n      this.initialize();\r\n    }\r\n\r\n    initialize() {\r\n      if (this.option.closeWhenClickBackdrop) {\r\n        this.$el.on('click', () => this.onCloseButtonClick());\r\n      }\r\n\r\n      this.$modalEl\r\n        .on('click', e => e.stopPropagation())\r\n        .on('click', '.ibs-btn-close', () => this.onCloseButtonClick());\r\n\r\n      this.$modalEl.css(\r\n        autoprefixer('transition', 'all ' + this.option.duration + 'ms')\r\n      );\r\n      this.setHeightWithWindowInnerHeight();\r\n      window.addEventListener(\r\n        'resize',\r\n        debounce(this.setHeightWithWindowInnerHeight).bind(this)\r\n      );\r\n    }\r\n    setHeightWithWindowInnerHeight() {\r\n      let height = window.innerHeight;\r\n      this.$el.height(height);\r\n    }\r\n    open() {\r\n      let callback = () => {\r\n        parentWindow.postMessage(Events.BEFORE_OPEN, ORIGIN);\r\n\r\n        this.activate();\r\n\r\n        this.backdrop.open();\r\n\r\n        this.$el.show();\r\n\r\n        this.$modalEl\r\n          .animate(\r\n            {\r\n              background: '#fff'\r\n            },\r\n            this.option.duration,\r\n            () => {\r\n              $('body').addClass('full-modal-open');\r\n\r\n              this.option.afterOpen.call(this);\r\n\r\n              parentWindow.postMessage(Events.AFTER_OPEN, ORIGIN);\r\n            }\r\n          )\r\n          .css(autoprefixer('transform', 'translateX(0)'))\r\n          .css({\r\n            opacity: 1\r\n          });\r\n\r\n        this.isOpen = true;\r\n      };\r\n\r\n      this.option.beforeOpen.call(this, callback);\r\n    }\r\n    scrollTop(top = 0) {\r\n      this.$modalBody.scrollTop(top);\r\n    }\r\n    onCloseButtonClick() {\r\n      if (this.isClosing) return;\r\n      this.isClosing = true;\r\n      this.option.beforeClose.call(this, this.close.bind(this));\r\n    }\r\n    close() {\r\n      this.isClosing = false;\r\n      parentWindow.postMessage(Events.BEFORE_CLOSE, ORIGIN);\r\n\r\n      this.backdrop.close();\r\n\r\n      this.$modalEl\r\n        .animate(\r\n          {\r\n            background: 'transparent'\r\n          },\r\n          this.option.duration,\r\n          () => {\r\n            \r\n            if(!modals.hasOpenedModal()){\r\n              $('body').removeClass('full-modal-open');\r\n            }\r\n\r\n            this.option.afterClose.call(this);\r\n\r\n            parentWindow.postMessage(Events.AFTER_CLOSE, ORIGIN);\r\n\r\n            this.$el.hide();\r\n            this.deactivate();\r\n          }\r\n        )\r\n        .css(autoprefixer('transform', 'translateX(30%)'))\r\n        .css({\r\n          opacity: 0\r\n        });\r\n\r\n      this.isOpen = false;\r\n    }\r\n\r\n    activate() {\r\n      modals.forEach(modal => {\r\n        if (modal === this) {\r\n          modal.isActivated = true;\r\n          modal.$el.css({\r\n            zIndex: ACTIVATED_ZINDEX\r\n          });\r\n        } else {\r\n          modal.isActivated = false;\r\n          modal.$el.css({\r\n            zIndex: DEACTIVATED_ZINDEX\r\n          });\r\n        }\r\n      });\r\n    }\r\n\r\n    deactivate() {\r\n      this.isActivated = false;\r\n      this.$el.css({\r\n        zIndex: DEACTIVATED_ZINDEX\r\n      });\r\n    }\r\n  }\r\n\r\n  function uniqueId(prefix = 'fm_') {\r\n    return `${prefix}${++global.__UID__}`;\r\n  }\r\n\r\n  function isString(str) {\r\n    return typeof str === 'string';\r\n  }\r\n\r\n  function autoprefixer(cssname, value) {\r\n    let prefixes = ['webkit', 'moz', 'ms', 'o'];\r\n    let cssRules = {};\r\n\r\n    prefixes.forEach(prefix => {\r\n      cssRules[`-${prefix}-${cssname}`] = value;\r\n    });\r\n    return cssRules;\r\n  }\r\n\r\n  const ALLOW_USER_INVOKES = ['open', 'close', 'scrollTop'];\r\n  const defaults = {\r\n    duration: 300,\r\n    trigger: '',\r\n    closeWhenClickBackdrop: true,\r\n    beforeOpen: function(callback) {\r\n      callback();\r\n    },\r\n    beforeClose: function(callback) {\r\n      callback();\r\n    },\r\n    afterOpen: $.noop,\r\n    afterClose: $.noop\r\n  };\r\n\r\n  $.fn.fullModal = function(options, ...args) {\r\n    return this.each(function() {\r\n      let $this = $(this);\r\n\r\n      if (isString(options)) {\r\n        let uid = $this.data('uniqueId');\r\n        let modal = fullModalMapper.get(uid);\r\n        let method = options;\r\n        // console.log('uid:',uid);\r\n        if (modal) {\r\n          if (ALLOW_USER_INVOKES.indexOf(method) < 0) {\r\n            return console.error(\r\n              `method:\"${method}\" is not allowed invoke on modal instance,expected method are [${ALLOW_USER_INVOKES.toString()}]`\r\n            );\r\n          }\r\n\r\n          return modal[method].apply(modal, args);\r\n        } else {\r\n          return console.error('please initialize modal first');\r\n        }\r\n      }\r\n\r\n      let option = $.extend({}, defaults, options);\r\n\r\n      let id = uniqueId();\r\n      let modal = new FullModal($this, option);\r\n      // console.log(id);\r\n      $this.data('uniqueId', id);\r\n\r\n      fullModalMapper.set(id, modal);\r\n      modals.push(modal);\r\n\r\n      if (option.trigger) {\r\n        $(option.trigger).on('click', function() {\r\n          modal.open();\r\n        });\r\n      }\r\n    });\r\n  };\r\n\r\n  $.fn.fullModal.Events = Events;\r\n\r\n  $.fn.fullModal.Defaults = defaults;\r\n})(window, jQuery);\r\n"]}