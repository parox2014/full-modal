{"version":3,"sources":["jquery.plugin.full-modal.js"],"names":["global","$","debounce","fn","delay","arguments","length","undefined","t","window","clearTimeout","setTimeout","bind","this","uniqueId","__UID__","isString","str","modal","isActivated","value","zIndex","$el","forEach","prefix","cssname","Error","fullModalMapper","Map","modals","backdrop","BEFORE_OPEN","BEFORE_CLOSE","ACTIVATED_ZINDEX","AFTER_OPEN","AFTER_CLOSE","DEACTIVATED_ZINDEX","parent","hasOpenedModal","parentWindow","item","i","ORIGIN","isOpen","Backdrop","container","duration","_classCallCheck","initialize","_createClass","key","el","on","option","filter","fadeOut","FullModal","$modalEl","openedModals","find","$modalBody","isClosing","_this","closeWhenClickBackdrop","onCloseButtonClick","e","stopPropagation","css","autoprefixer","setHeightWithWindowInnerHeight","height","innerHeight","_this2","postMessage","Events","activate","open","show","animate","background","afterOpen","call","opacity","top","scrollTop","close","_this3","addClass","removeClass","afterClose","hide","deactivate","ALLOW_USER_INVOKES","defaults","trigger","beforeOpen","callback","beforeClose","noop","fullModal","options","_len","args","Array","_key","each","$this","uid","data","get","method","console","error","toString","apply","extend","id","push","Defaults"],"mappings":"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","file":"jquery.plugin.full-modal.min.js","sourcesContent":["(function(global, $) {\r\n  if (!$) throw new Error('请先加载jquery');\r\n\r\n  const fullModalMapper = new Map();\r\n\r\n  /**\r\n   * @type {FullModal[]}\r\n   */\r\n  const modals = [];\r\n  global.__UID__ = 0;\r\n  let backdrop;\r\n\r\n  const ACTIVATED_ZINDEX = 102;\r\n\r\n  const DEACTIVATED_ZINDEX = 101;\r\n\r\n  const Events = {\r\n    BEFORE_OPEN: 'BEFORE_OPEN',\r\n    BEFORE_CLOSE: 'BEFORE_CLOSE',\r\n    AFTER_OPEN: 'AFTER_OPEN',\r\n    AFTER_CLOSE: 'AFTER_CLOSE'\r\n  };\r\n\r\n  let parentWindow = global.parent || global;\r\n\r\n  const ORIGIN ='*';\r\n\r\n  modals.hasOpenedModal=function(){\r\n\r\n    for(let i=0;i<this.length;i++){\r\n      let item=this[i];\r\n      console.log(item);\r\n      if(item.isOpen){\r\n        return true;\r\n      }\r\n    }\r\n    return false;\r\n  }\r\n\r\n  function debounce(fn, delay = 100) {\r\n    let t;\r\n    return function() {\r\n      window.clearTimeout(t);\r\n\r\n      t = setTimeout(fn.bind(this), delay);\r\n    };\r\n  }\r\n\r\n  class Backdrop {\r\n    constructor(container, duration) {\r\n      if (backdrop instanceof Backdrop) return backdrop;\r\n\r\n      this.isOpen = false;\r\n      this.duration = duration;\r\n      this.container = $(container);\r\n      this.initialize();\r\n    }\r\n\r\n    initialize() {\r\n      let el = (this.$el = $('<div class=\"ibs-backdrop\"></div>'));\r\n      this.container.append(el);\r\n      el.on('click', () => {\r\n        modals.forEach(item => {\r\n          if (item.option.closeWhenClickBackdrop) {\r\n            item.close();\r\n          }\r\n        });\r\n      });\r\n    }\r\n\r\n    open() {\r\n      this.$el.fadeIn(this.duration);\r\n      this.isOpen = true;\r\n    }\r\n\r\n    close() {\r\n      let openedModals = modals.filter(item => item.isOpen);\r\n\r\n      if (openedModals.length > 1) return;\r\n\r\n      this.$el.fadeOut(this.duration);\r\n      this.isOpen = false;\r\n    }\r\n  }\r\n\r\n  class FullModal {\r\n    /**\r\n     * create a modal instance\r\n     * @param el {jQuery|*}\r\n     * @param option {Object}\r\n     */\r\n    constructor(el, option) {\r\n      this.$el = el;\r\n      this.option = option;\r\n      this.$modalEl = this.$el.find('.ibs-full-modal');\r\n      this.$modalBody = this.$el.find('.ibs-modal-body');\r\n      this.isOpen = false;\r\n      this.isActivated = false;\r\n      this.isClosing = false;\r\n      this.backdrop = backdrop = new Backdrop('body', option.duration + 200);\r\n      this.initialize();\r\n    }\r\n\r\n    initialize() {\r\n      if (this.option.closeWhenClickBackdrop) {\r\n        this.$el.on('click', () => this.onCloseButtonClick());\r\n      }\r\n\r\n      this.$modalEl\r\n        .on('click', e => e.stopPropagation())\r\n        .on('click', '.ibs-btn-close', () => this.onCloseButtonClick());\r\n\r\n      this.$modalEl.css(\r\n        autoprefixer('transition', 'all ' + this.option.duration + 'ms')\r\n      );\r\n      this.setHeightWithWindowInnerHeight();\r\n      window.addEventListener(\r\n        'resize',\r\n        debounce(this.setHeightWithWindowInnerHeight).bind(this)\r\n      );\r\n    }\r\n    setHeightWithWindowInnerHeight() {\r\n      let height = window.innerHeight;\r\n      this.$el.height(height);\r\n    }\r\n    open() {\r\n      let callback = () => {\r\n        parentWindow.postMessage(Events.BEFORE_OPEN, ORIGIN);\r\n\r\n        this.activate();\r\n\r\n        this.backdrop.open();\r\n\r\n        this.$el.show();\r\n\r\n        this.$modalEl\r\n          .animate(\r\n            {\r\n              background: '#fff'\r\n            },\r\n            this.option.duration,\r\n            () => {\r\n              $('body').addClass('full-modal-open');\r\n\r\n              this.option.afterOpen.call(this);\r\n\r\n              parentWindow.postMessage(Events.AFTER_OPEN, ORIGIN);\r\n            }\r\n          )\r\n          .css(autoprefixer('transform', 'translateX(0)'))\r\n          .css({\r\n            opacity: 1\r\n          });\r\n\r\n        this.isOpen = true;\r\n      };\r\n\r\n      this.option.beforeOpen.call(this, callback);\r\n    }\r\n    scrollTop(top = 0) {\r\n      this.$modalBody.scrollTop(top);\r\n    }\r\n    onCloseButtonClick() {\r\n      if (this.isClosing) return;\r\n      this.isClosing = true;\r\n      this.option.beforeClose.call(this, this.close.bind(this));\r\n    }\r\n    close() {\r\n      this.isClosing = false;\r\n      parentWindow.postMessage(Events.BEFORE_CLOSE, ORIGIN);\r\n\r\n      this.backdrop.close();\r\n\r\n      this.$modalEl\r\n        .animate(\r\n          {\r\n            background: 'transparent'\r\n          },\r\n          this.option.duration,\r\n          () => {\r\n            \r\n            if(!modals.hasOpenedModal()){\r\n              $('body').removeClass('full-modal-open');\r\n            }\r\n\r\n            this.option.afterClose.call(this);\r\n\r\n            parentWindow.postMessage(Events.AFTER_CLOSE, ORIGIN);\r\n\r\n            this.$el.hide();\r\n            this.deactivate();\r\n          }\r\n        )\r\n        .css(autoprefixer('transform', 'translateX(30%)'))\r\n        .css({\r\n          opacity: 0\r\n        });\r\n\r\n      this.isOpen = false;\r\n    }\r\n\r\n    activate() {\r\n      modals.forEach(modal => {\r\n        if (modal === this) {\r\n          modal.isActivated = true;\r\n          modal.$el.css({\r\n            zIndex: ACTIVATED_ZINDEX\r\n          });\r\n        } else {\r\n          modal.isActivated = false;\r\n          modal.$el.css({\r\n            zIndex: DEACTIVATED_ZINDEX\r\n          });\r\n        }\r\n      });\r\n    }\r\n\r\n    deactivate() {\r\n      this.isActivated = false;\r\n      this.$el.css({\r\n        zIndex: DEACTIVATED_ZINDEX\r\n      });\r\n    }\r\n  }\r\n\r\n  function uniqueId(prefix = 'fm_') {\r\n    return `${prefix}${++global.__UID__}`;\r\n  }\r\n\r\n  function isString(str) {\r\n    return typeof str === 'string';\r\n  }\r\n\r\n  function autoprefixer(cssname, value) {\r\n    let prefixes = ['webkit', 'moz', 'ms', 'o'];\r\n    let cssRules = {};\r\n\r\n    prefixes.forEach(prefix => {\r\n      cssRules[`-${prefix}-${cssname}`] = value;\r\n    });\r\n    return cssRules;\r\n  }\r\n\r\n  const ALLOW_USER_INVOKES = ['open', 'close', 'scrollTop'];\r\n  const defaults = {\r\n    duration: 300,\r\n    trigger: '',\r\n    closeWhenClickBackdrop: true,\r\n    beforeOpen: function(callback) {\r\n      callback();\r\n    },\r\n    beforeClose: function(callback) {\r\n      callback();\r\n    },\r\n    afterOpen: $.noop,\r\n    afterClose: $.noop\r\n  };\r\n\r\n  $.fn.fullModal = function(options, ...args) {\r\n    return this.each(function() {\r\n      let $this = $(this);\r\n\r\n      if (isString(options)) {\r\n        let uid = $this.data('uniqueId');\r\n        let modal = fullModalMapper.get(uid);\r\n        let method = options;\r\n        // console.log('uid:',uid);\r\n        if (modal) {\r\n          if (ALLOW_USER_INVOKES.indexOf(method) < 0) {\r\n            return console.error(\r\n              `method:\"${method}\" is not allowed invoke on modal instance,expected method are [${ALLOW_USER_INVOKES.toString()}]`\r\n            );\r\n          }\r\n\r\n          return modal[method].apply(modal, args);\r\n        } else {\r\n          return console.error('please initialize modal first');\r\n        }\r\n      }\r\n\r\n      let option = $.extend({}, defaults, options);\r\n\r\n      let id = uniqueId();\r\n      let modal = new FullModal($this, option);\r\n      // console.log(id);\r\n      $this.data('uniqueId', id);\r\n\r\n      fullModalMapper.set(id, modal);\r\n      modals.push(modal);\r\n\r\n      if (option.trigger) {\r\n        $(option.trigger).on('click', function() {\r\n          modal.open();\r\n        });\r\n      }\r\n    });\r\n  };\r\n\r\n  $.fn.fullModal.Events = Events;\r\n\r\n  $.fn.fullModal.Defaults = defaults;\r\n})(window, jQuery);\r\n"]}