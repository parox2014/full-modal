{"version":3,"sources":["jquery.plugin.full-modal.js"],"names":["global","$","arguments","length","undefined","removeClass","Date","now","parentWindow","str","css","autoprefixer","value","cssRules","forEach","prefix","cssname","Error","fullModalMapper","Map","modals","backdrop","BEFORE_OPEN","BEFORE_CLOSE","ACTIVATED_ZINDEX","AFTER_OPEN","AFTER_CLOSE","DEACTIVATED_ZINDEX","parent","origin","indexOf","location","Backdrop","container","duration","_classCallCheck","this","ORIGIN","initialize","_createClass","key","el","$el","isOpen","append","on","closeWhenClickBackdrop","item","close","fadeIn","filter","fadeOut","FullModal","openedModals","option","$modalEl","find","$modalBody","isActivated","_this","e","stopPropagation","call","Events","activate","open","show","background","addClass","_this2","postMessage","opacity","top","scrollTop","_this3","deactivate","_this4","modal","zIndex","ALLOW_USER_INVOKES","trigger","beforeClose","noop","afterOpen","afterClose","fn","fullModal","options","_len","args","Array","_key","each","$this","isString","get","data","method","console","error","toString","apply","extend","defaults","id","beforeOpen","Defaults","window","jQuery"],"mappings":"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","file":"jquery.plugin.full-modal.min.js","sourcesContent":["(function (global, $) {\r\n  if (!$) throw new Error('请先加载jquery');\r\n  \r\n  const fullModalMapper = new Map();\r\n  const modals=[];\r\n  \r\n  let backdrop;\r\n  \r\n  const ACTIVATED_ZINDEX=102;\r\n  \r\n  const DEACTIVATED_ZINDEX=101;\r\n  \r\n  const Events={\r\n    BEFORE_OPEN:'BEFORE_OPEN',\r\n    BEFORE_CLOSE:'BEFORE_CLOSE',\r\n    AFTER_OPEN:'AFTER_OPEN',\r\n    AFTER_CLOSE:'AFTER_CLOSE',    \r\n  };\r\n\r\n  let parentWindow=global.parent||global;\r\n\r\n  const ORIGIN=location.origin.indexOf('http')>-1?location.origin:'*';\r\n\r\n  class Backdrop {\r\n    constructor(container, duration) {\r\n      if (backdrop instanceof Backdrop) return backdrop;\r\n      \r\n      this.isOpen = false;\r\n      this.duration = duration;\r\n      this.container = $(container);\r\n      this.initialize();\r\n    }\r\n    \r\n    initialize() {\r\n      let el = this.$el = $('<div class=\"ibs-backdrop\"></div>');\r\n      this.container.append(el);\r\n      el.on('click',()=>{\r\n        modals.forEach(item=>{\r\n          if(item.option.closeWhenClickBackdrop){\r\n            item.close();\r\n          }\r\n        })\r\n      });\r\n    }\r\n    \r\n    open() {\r\n      this.$el.fadeIn(this.duration);\r\n      this.isOpen = true;\r\n    }\r\n    \r\n    close() {\r\n      let openedModals=modals.filter(item=>item.isOpen);\r\n      \r\n      if(openedModals.length>1)return;\r\n      \r\n      this.$el.fadeOut(this.duration);\r\n      this.isOpen = false;\r\n    }\r\n  }\r\n  \r\n  \r\n  class FullModal {\r\n    /**\r\n     * create a modal instance\r\n     * @param el {jQuery|*}\r\n     * @param option {Object}\r\n     */\r\n    constructor(el, option) {\r\n      this.$el = el;\r\n      this.option = option;\r\n      this.$modalEl = this.$el.find('.ibs-full-modal');\r\n      this.$modalBody=this.$el.find('.ibs-modal-body');\r\n      this.isOpen = false;\r\n      this.isActivated=false;\r\n      this.backdrop = backdrop = new Backdrop('body', option.duration + 200);\r\n      this.initialize();\r\n    }\r\n    \r\n    initialize() {\r\n      \r\n      if (this.option.closeWhenClickBackdrop) {\r\n        this.$el.on('click', () => this.close());\r\n      }\r\n      \r\n      this.$modalEl.on('click', e => e.stopPropagation())\r\n        .on('click', '.ibs-btn-close', () => this.close());\r\n      \r\n      this.$modalEl.css(autoprefixer('transition','all '+this.option.duration+'ms'));\r\n    }\r\n    \r\n    open() {\r\n      this.option.beforeOpen.call(this);\r\n      \r\n      parentWindow.postMessage(Events.BEFORE_OPEN,ORIGIN)\r\n\r\n      this.activate();\r\n      \r\n      this.backdrop.open();\r\n      \r\n      this.$el.show();\r\n      \r\n      this.$modalEl.animate({\r\n        background: '#fff'\r\n      },this.option.duration,()=>{\r\n\r\n        $('body').addClass('full-modal-open');\r\n\r\n        this.option.afterOpen.call(this);\r\n\r\n        parentWindow.postMessage(Events.AFTER_OPEN,ORIGIN);\r\n\r\n      }).css(autoprefixer('transform', 'translateX(0)'))\r\n        .css({opacity:1});\r\n      \r\n      this.isOpen = true;\r\n    }\r\n    scrollTop(top=0){\r\n      this.$modalBody.scrollTop(top);\r\n    }\r\n    close() {\r\n      this.option.beforeClose.call(this);\r\n      \r\n      parentWindow.postMessage(Events.BEFORE_CLOSE,ORIGIN);\r\n\r\n      this.backdrop.close();\r\n\r\n      this.$modalEl.animate({\r\n        background: 'transparent'\r\n      },this.option.duration,()=>{\r\n\r\n        $('body').removeClass('full-modal-open');\r\n\r\n        this.option.afterClose.call(this);\r\n        \r\n        parentWindow.postMessage(Events.AFTER_CLOSE,ORIGIN);\r\n\r\n        this.$el.hide();\r\n        this.deactivate();\r\n      })\r\n        .css(autoprefixer('transform', 'translateX(30%)'))\r\n        .css({opacity:0});\r\n      \r\n      this.isOpen = false;\r\n    }\r\n  \r\n    activate(){\r\n     \r\n      modals.forEach(modal=>{\r\n        if(modal===this){\r\n          modal.isActivated=true;\r\n          modal.$el.css({zIndex:ACTIVATED_ZINDEX});\r\n        }else{\r\n          modal.isActivated=false;\r\n          modal.$el.css({zIndex:DEACTIVATED_ZINDEX});\r\n        }\r\n      });\r\n    }\r\n    \r\n    deactivate(){\r\n      this.isActivated=false;\r\n      this.$el.css({zIndex:DEACTIVATED_ZINDEX});\r\n    }\r\n  }\r\n  \r\n  \r\n  function uniqueId(prefix = 'full-modal-') {\r\n    return `${prefix}${Date.now()}`;\r\n  }\r\n  \r\n  function isString(str) {\r\n    return typeof str === 'string';\r\n  }\r\n  \r\n  function autoprefixer(cssname, value) {\r\n    let prefixes=['webkit','moz','ms','o'];\r\n    let cssRules={};\r\n    \r\n    prefixes.forEach(prefix=>{\r\n      cssRules[`-${prefix}-${cssname}`]=value;\r\n    });\r\n    return cssRules;\r\n  }\r\n  \r\n  const ALLOW_USER_INVOKES = ['open', 'close','scrollTop'];\r\n  const defaults = {\r\n    duration: 300,\r\n    trigger: '',\r\n    closeWhenClickBackdrop: true,\r\n    beforeOpen: $.noop,\r\n    beforeClose: $.noop,\r\n    afterOpen: $.noop,\r\n    afterClose: $.noop\r\n  };\r\n  \r\n  $.fn.fullModal = function (options,...args) {\r\n    \r\n    return this.each(function () {\r\n      let $this = $(this);\r\n      \r\n      if (isString(options)) {\r\n        \r\n        let modal = fullModalMapper.get($this.data('uniqueId'));\r\n        let method = options;\r\n        \r\n        if (modal) {\r\n          \r\n          if (ALLOW_USER_INVOKES.indexOf(method) < 0) {\r\n            return console.error(`method:\"${method}\" is not allowed invoke on modal instance,expected method are [${ALLOW_USER_INVOKES.toString()}]`);\r\n          }\r\n          \r\n          return modal[method].apply(modal,args);\r\n        } else {\r\n          return console.error('please initialize modal first');\r\n        }\r\n      }\r\n      \r\n      let option = $.extend(defaults, options);\r\n      \r\n      let id = uniqueId();\r\n      let modal = new FullModal($this, option);\r\n      \r\n      $this.data('uniqueId', id);\r\n      \r\n      fullModalMapper.set(id, modal);\r\n      modals.push(modal);\r\n      \r\n      if(option.trigger){\r\n        $(option.trigger).on('click', function () {\r\n          modal.open();\r\n        });\r\n      }\r\n    });\r\n  };\r\n\r\n  $.fn.fullModal.Events=Events;\r\n\r\n  $.fn.fullModal.Defaults=defaults;\r\n})(window, jQuery);"]}