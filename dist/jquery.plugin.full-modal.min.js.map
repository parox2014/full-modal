{"version":3,"sources":["jquery.plugin.full-modal.js"],"names":["global","$","opacity","arguments","length","undefined","Date","now","isString","str","autoprefixer","cssname","value","modals","modal","isActivated","$el","cssRules","Error","fullModalMapper","Map","backdrop","BEFORE_OPEN","BEFORE_CLOSE","ACTIVATED_ZINDEX","AFTER_OPEN","AFTER_CLOSE","DEACTIVATED_ZINDEX","parent","location","origin","indexOf","Backdrop","parentWindow","_classCallCheck","this","isOpen","duration","container","initialize","_createClass","key","el","append","on","item","option","closeWhenClickBackdrop","close","forEach","filter","fadeOut","fadeIn","FullModal","$modalEl","find","$modalBody","_this","e","stopPropagation","onCloseButtonClick","css","callback","call","postMessage","Events","ORIGIN","_this2","activate","open","show","animate","background","addClass","top","scrollTop","bind","_this3","afterClose","hide","_this4","beforeClose","zIndex","trigger","beforeOpen","noop","fn","fullModal","options","_len","args","Array","_key","each","$this","prefix","get","data","method","ALLOW_USER_INVOKES","console","error","toString","apply","extend","defaults","id","set","Defaults","window","jQuery"],"mappings":"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","file":"jquery.plugin.full-modal.min.js","sourcesContent":["(function (global, $) {\r\n  if (!$) throw new Error('请先加载jquery');\r\n\r\n  const fullModalMapper = new Map();\r\n  const modals = [];\r\n\r\n  let backdrop;\r\n\r\n  const ACTIVATED_ZINDEX = 102;\r\n\r\n  const DEACTIVATED_ZINDEX = 101;\r\n\r\n  const Events = {\r\n    BEFORE_OPEN: 'BEFORE_OPEN',\r\n    BEFORE_CLOSE: 'BEFORE_CLOSE',\r\n    AFTER_OPEN: 'AFTER_OPEN',\r\n    AFTER_CLOSE: 'AFTER_CLOSE',\r\n  };\r\n\r\n  let parentWindow = global.parent || global;\r\n\r\n  const ORIGIN = location.origin.indexOf('http') > -1 ? location.origin : '*';\r\n\r\n\r\n  class Backdrop {\r\n    constructor(container, duration) {\r\n      if (backdrop instanceof Backdrop) return backdrop;\r\n\r\n      this.isOpen = false;\r\n      this.duration = duration;\r\n      this.container = $(container);\r\n      this.initialize();\r\n    }\r\n\r\n    initialize() {\r\n      let el = this.$el = $('<div class=\"ibs-backdrop\"></div>');\r\n      this.container.append(el);\r\n      el.on('click', () => {\r\n        modals.forEach(item => {\r\n          if (item.option.closeWhenClickBackdrop) {\r\n            item.close();\r\n          }\r\n        })\r\n      });\r\n    }\r\n\r\n    open() {\r\n      this.$el.fadeIn(this.duration);\r\n      this.isOpen = true;\r\n    }\r\n\r\n    close() {\r\n      let openedModals = modals.filter(item => item.isOpen);\r\n\r\n      if (openedModals.length > 1) return;\r\n\r\n      this.$el.fadeOut(this.duration);\r\n      this.isOpen = false;\r\n    }\r\n  }\r\n\r\n\r\n  class FullModal {\r\n    /**\r\n     * create a modal instance\r\n     * @param el {jQuery|*}\r\n     * @param option {Object}\r\n     */\r\n    constructor(el, option) {\r\n      this.$el = el;\r\n      this.option = option;\r\n      this.$modalEl = this.$el.find('.ibs-full-modal');\r\n      this.$modalBody = this.$el.find('.ibs-modal-body');\r\n      this.isOpen = false;\r\n      this.isActivated = false;\r\n      this.backdrop = backdrop = new Backdrop('body', option.duration + 200);\r\n      this.initialize();\r\n    }\r\n\r\n    initialize() {\r\n\r\n      if (this.option.closeWhenClickBackdrop) {\r\n        this.$el.on('click', () => this.close());\r\n      }\r\n\r\n      this.$modalEl.on('click', e => e.stopPropagation())\r\n        .on('click', '.ibs-btn-close', () => this.onCloseButtonClick());\r\n\r\n      this.$modalEl.css(autoprefixer('transition', 'all ' + this.option.duration + 'ms'));\r\n    }\r\n\r\n    open() {\r\n\r\n      let callback = () => {\r\n        parentWindow.postMessage(Events.BEFORE_OPEN, ORIGIN)\r\n\r\n        this.activate();\r\n\r\n        this.backdrop.open();\r\n\r\n        this.$el.show();\r\n\r\n        this.$modalEl.animate({\r\n            background: '#fff'\r\n          }, this.option.duration, () => {\r\n\r\n            $('body').addClass('full-modal-open');\r\n\r\n            this.option.afterOpen.call(this);\r\n\r\n            parentWindow.postMessage(Events.AFTER_OPEN, ORIGIN);\r\n\r\n          }).css(autoprefixer('transform', 'translateX(0)'))\r\n          .css({\r\n            opacity: 1\r\n          });\r\n\r\n        this.isOpen = true;\r\n      }\r\n\r\n      this.option.beforeOpen.call(this, callback);\r\n\r\n    }\r\n    scrollTop(top = 0) {\r\n      this.$modalBody.scrollTop(top);\r\n    }\r\n    onCloseButtonClick() {\r\n      this.option.beforeClose.call(this, this.close.bind(this));\r\n    }\r\n    close() {\r\n      parentWindow.postMessage(Events.BEFORE_CLOSE, ORIGIN);\r\n\r\n      this.backdrop.close();\r\n\r\n      this.$modalEl.animate({\r\n          background: 'transparent'\r\n        }, this.option.duration, () => {\r\n\r\n          $('body').removeClass('full-modal-open');\r\n\r\n          this.option.afterClose.call(this);\r\n\r\n          parentWindow.postMessage(Events.AFTER_CLOSE, ORIGIN);\r\n\r\n          this.$el.hide();\r\n          this.deactivate();\r\n        })\r\n        .css(autoprefixer('transform', 'translateX(30%)'))\r\n        .css({\r\n          opacity: 0\r\n        });\r\n\r\n      this.isOpen = false;\r\n    }\r\n\r\n    activate() {\r\n\r\n      modals.forEach(modal => {\r\n        if (modal === this) {\r\n          modal.isActivated = true;\r\n          modal.$el.css({\r\n            zIndex: ACTIVATED_ZINDEX\r\n          });\r\n        } else {\r\n          modal.isActivated = false;\r\n          modal.$el.css({\r\n            zIndex: DEACTIVATED_ZINDEX\r\n          });\r\n        }\r\n      });\r\n    }\r\n\r\n    deactivate() {\r\n      this.isActivated = false;\r\n      this.$el.css({\r\n        zIndex: DEACTIVATED_ZINDEX\r\n      });\r\n    }\r\n  }\r\n\r\n\r\n  function uniqueId(prefix = 'full-modal-') {\r\n    return `${prefix}${Date.now()}`;\r\n  }\r\n\r\n  function isString(str) {\r\n    return typeof str === 'string';\r\n  }\r\n\r\n  function autoprefixer(cssname, value) {\r\n    let prefixes = ['webkit', 'moz', 'ms', 'o'];\r\n    let cssRules = {};\r\n\r\n    prefixes.forEach(prefix => {\r\n      cssRules[`-${prefix}-${cssname}`] = value;\r\n    });\r\n    return cssRules;\r\n  }\r\n\r\n  const ALLOW_USER_INVOKES = ['open', 'close', 'scrollTop'];\r\n  const defaults = {\r\n    duration: 300,\r\n    trigger: '',\r\n    closeWhenClickBackdrop: true,\r\n    beforeOpen: function (callback) {\r\n      callback()\r\n    },\r\n    beforeClose: function (callback) {\r\n      callback()\r\n    },\r\n    afterOpen: $.noop,\r\n    afterClose: $.noop\r\n  };\r\n\r\n  $.fn.fullModal = function (options, ...args) {\r\n\r\n    return this.each(function () {\r\n      let $this = $(this);\r\n\r\n      if (isString(options)) {\r\n\r\n        let modal = fullModalMapper.get($this.data('uniqueId'));\r\n        let method = options;\r\n\r\n        if (modal) {\r\n\r\n          if (ALLOW_USER_INVOKES.indexOf(method) < 0) {\r\n            return console.error(`method:\"${method}\" is not allowed invoke on modal instance,expected method are [${ALLOW_USER_INVOKES.toString()}]`);\r\n          }\r\n\r\n          return modal[method].apply(modal, args);\r\n        } else {\r\n          return console.error('please initialize modal first');\r\n        }\r\n      }\r\n\r\n      let option = $.extend(defaults, options);\r\n\r\n      let id = uniqueId();\r\n      let modal = new FullModal($this, option);\r\n\r\n      $this.data('uniqueId', id);\r\n\r\n      fullModalMapper.set(id, modal);\r\n      modals.push(modal);\r\n\r\n      if (option.trigger) {\r\n        $(option.trigger).on('click', function () {\r\n          modal.open();\r\n        });\r\n      }\r\n    });\r\n  };\r\n\r\n  $.fn.fullModal.Events = Events;\r\n\r\n  $.fn.fullModal.Defaults = defaults;\r\n})(window, jQuery);"]}